<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CVI æ­£å‘äº’å‹•è¨“ç·´ V6.3 (SVGçµ‚æ¥µç‰ˆ)</title>
    <style>
        /* --- 1. åŸºç¤è¨­å®š --- */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; -webkit-tap-highlight-color: transparent;
            font-family: "Microsoft JhengHei", sans-serif;
            transition: background-color 0.3s;
            background-color: var(--bg-color); /* ä½¿ç”¨è®Šæ•¸æ§åˆ¶èƒŒæ™¯ */
            user-select: none; 
            -webkit-touch-callout: none;
        }

        /* å®šç¾©å…¨åŸŸè®Šæ•¸ (é è¨­é»‘åº•ç™½ç·š) */
        :root { 
            --bg-color: #000000;
            --main-color: #FFFFFF; 
            --line-width: 3vmin; 
        }

        /* --- 2. éŠæˆ²ä¸»é«”å®¹å™¨ --- */
        #game-scaler {
            width: 50vmin; height: 50vmin; position: relative;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        #game-scaler.active { transform: scale(1.8); }

        /* --- 3. æ¨¡å¼ä¸€ï¼šCSS ç·šæ¢ç¬‘è‡‰ (ç©ºå¿ƒ) --- */
        .css-face {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            display: none;
        }
        .css-face.current-face { display: block; }

        .face-circle {
            width: 100%; height: 100%;
            border: var(--line-width) solid var(--main-color);
            border-radius: 50%; position: absolute; box-sizing: border-box;
        }
        .eye {
            width: 15%; height: 15%;
            background-color: var(--main-color);
            border-radius: 50%; position: absolute; top: 30%;
        }
        .eye.left { left: 25%; }
        .eye.right { right: 25%; }
        .mouth {
            width: 50%; height: 25%;
            border-radius: 50%; position: absolute; left: 25%; box-sizing: border-box;
            border-bottom: var(--line-width) solid var(--main-color); 
            bottom: 20%;
        }

        /* --- 4. æ¨¡å¼äºŒï¼šSVG å¯¦å¿ƒç¬‘è‡‰ (æ›¿ä»£èˆŠ Emoji) --- */
        /* SVG è®“é¡è‰²æ§åˆ¶ç²¾æº–ï¼Œä¸æœƒæœ‰é»ƒè‰²æ®˜ç•™ï¼Œä¹Ÿä¸æœƒæ¶ˆå¤± */
        .svg-face {
            width: 100%; height: 100%; 
            display: none;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); /* å¢åŠ ä¸€é»ç«‹é«”æ„Ÿ */
            opacity: 1; transition: opacity 0.2s;
        }
        .svg-face.current-face { display: block; }
        
        /* SVG å…§éƒ¨çš„é¡è‰²ç¶å®š CSS è®Šæ•¸ */
        .svg-fill { fill: var(--main-color); }
        .svg-features { fill: var(--bg-color); } /* çœ¼ç›å˜´å·´æŒ–ç©º(é¡¯ç¤ºèƒŒæ™¯è‰²) */


        /* --- 5. é˜²èª¤è§¸è¨­å®šéµ (é•·æŒ‰) --- */
        #settings-trigger-area {
            position: fixed; top: 0; left: 0; width: 80px; height: 80px;
            z-index: 100; pointer-events: auto;
            display: flex; justify-content: center; align-items: center;
        }
        #settings-btn {
            font-size: 30px; color: #555; 
            opacity: 0.5; transition: all 0.2s;
            position: relative;
            width: 50px; height: 50px;
            display: flex; justify-content: center; align-items: center;
            border-radius: 50%;
        }
        .progress-ring {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            border-radius: 50%; border: 4px solid transparent; border-top-color: #ff3333;
            display: none; animation: spin 2s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


        /* --- 6. è¨­å®šä»‹é¢ --- */
        #settings-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(10, 10, 10, 0.98);
            z-index: 101; display: none;
            flex-direction: column; justify-content: center; align-items: center;
            color: #FFF; pointer-events: auto;
        }
        .settings-box {
            background: #2a2a2a; padding: 20px; border-radius: 15px;
            width: 90%; max-width: 500px; max-height: 95vh; overflow-y: auto;
            border: 1px solid #444; display: flex; flex-direction: column; gap: 15px;
        }
        .setting-group { border-bottom: 1px solid #444; padding-bottom: 15px; }
        .setting-label { display: block; margin-bottom: 8px; font-weight: bold; color: #ddd; }
        input[type=range] { width: 100%; height: 30px; }
        .btn-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .btn-group.modes { grid-template-columns: repeat(2, 1fr); }
        .option-btn {
            padding: 10px 5px; border: 2px solid #444; background: #1a1a1a; color: #ccc;
            border-radius: 8px; cursor: pointer; text-align: center; font-size: 0.85em;
        }
        .option-btn.selected { border-color: #fff; background: #444; color: #fff; font-weight: bold; }
        .dot { width: 15px; height: 15px; border-radius: 50%; margin-bottom: 5px; border: 1px solid #666; display:inline-block; margin-right:5px; vertical-align:middle;}
        
        #log-area {
            width: 100%; height: 100px; background: #000; color: #0f0; 
            font-family: monospace; font-size: 12px; border: 1px solid #555; padding: 10px;
            overflow-y: scroll; resize: none; box-sizing: border-box;
        }
        .log-controls { display: flex; gap: 10px; margin-top: 5px; }
        .action-btn { flex: 1; padding: 8px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-copy { background: #28a745; color: #fff; }
        .btn-clear { background: #dc3545; color: #fff; }
        .btn-close { background: #007bff; color: #fff; width: 100%; padding: 12px; font-size: 16px; margin-top: 10px;}

    </style>
</head>
<body oncontextmenu="return false;">

    <div id="settings-trigger-area">
        <div id="settings-btn">
            âš™ï¸
            <div class="progress-ring" id="progress-ring"></div>
        </div>
    </div>

    <div id="game-scaler">
        <div class="css-face" id="face-line">
            <div class="face-circle"></div><div class="eye left"></div><div class="eye right"></div><div class="mouth"></div>
        </div>
        
        <svg class="svg-face" id="face-solid" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="48" class="svg-fill" />
            <circle cx="32" cy="38" r="6" class="svg-features" />
            <circle cx="68" cy="38" r="6" class="svg-features" />
            <path d="M 25 60 Q 50 85 75 60" stroke-width="6" stroke-linecap="round" fill="none" class="svg-features" stroke="var(--bg-color)" />
        </svg>
    </div>

    <div id="settings-overlay">
        <div class="settings-box">
            <h2 style="margin:0 0 10px 0; text-align:center;">æ•™å¸«æ§åˆ¶å° (V6.3)</h2>
            
            <div class="setting-group">
                <label class="setting-label">è¦–è¦ºæ¼¸é™¤ (ç·šæ¢ç²—ç´°/å¼·åº¦): <span id="fade-val">100%</span></label>
                <input type="range" id="fade-slider" min="1" max="50" value="30">
            </div>

            <div class="setting-group">
                <label class="setting-label">åœ–åƒæ•´é«”å¤§å°</label>
                <input type="range" id="size-slider" min="20" max="90" value="50">
            </div>

            <div class="setting-group">
                <label class="setting-label">è‰²å½©ä¸»é¡Œ</label>
                <div class="btn-group">
                    <div class="option-btn selected" onclick="setTheme('bw')" id="btn-bw"><span class="dot" style="background:#000; border:1px solid #fff;"></span>é»‘ç™½</div>
                    <div class="option-btn" onclick="setTheme('br')" id="btn-br"><span class="dot" style="background:#000; border:1px solid #f00;"></span>é»‘ç´…</div>
                    <div class="option-btn" onclick="setTheme('wr')" id="btn-wr"><span class="dot" style="background:#fff; border:1px solid #f00;"></span>ç™½ç´…</div>
                    <div class="option-btn" onclick="setTheme('by')" id="btn-by"><span class="dot" style="background:#000; border:1px solid #ff0;"></span>é»‘é»ƒ</div>
                    <div class="option-btn" onclick="setTheme('bb')" id="btn-bb"><span class="dot" style="background:#000; border:1px solid #06f;"></span>é»‘è—</div>
                    <div class="option-btn" onclick="setTheme('bg')" id="btn-bg"><span class="dot" style="background:#000; border:1px solid #0f0;"></span>é»‘ç¶ </div>
                </div>
            </div>

            <div class="setting-group">
                <label class="setting-label">è¡¨æƒ…æ¨¡å¼</label>
                <div class="btn-group modes">
                    <div class="option-btn selected" onclick="setMode('line')" id="btn-mode-line">ğŸ˜ƒ ç·šæ¢(ç©ºå¿ƒ)</div>
                    <div class="option-btn" onclick="setMode('solid')" id="btn-mode-solid">ğŸ˜Š å¯¦å¿ƒ(Emoji)</div>
                </div>
            </div>

            <div class="setting-group" style="border:none;">
                <label class="setting-label">äº’å‹•ç´€éŒ„ (è¤‡è£½åˆ° IEP)</label>
                <textarea id="log-area" readonly placeholder="å°šæœªæœ‰äº’å‹•ç´€éŒ„..."></textarea>
                <div class="log-controls">
                    <button class="action-btn btn-copy" onclick="copyLog()">ğŸ“‹ è¤‡è£½æ•¸æ“š</button>
                    <button class="action-btn btn-clear" onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤</button>
                </div>
            </div>

            <button class="action-btn btn-close" id="close-settings">é—œé–‰ä¸¦è¿”å›éŠæˆ²</button>
        </div>
    </div>

    <audio id="sound-happy" src="https://www.soundjay.com/human/sounds/laughter-1.mp3"></audio>

    <script>
        // --- æ ¸å¿ƒè®Šæ•¸ ---
        const root = document.documentElement;
        const gameScaler = document.getElementById('game-scaler');
        const logArea = document.getElementById('log-area');
        const svgFace = document.getElementById('face-solid');
        
        let currentMode = 'line';
        let currentTheme = 'bw';
        let isPlaying = false;
        let animationTimer = null;
        let sessionLogs = [];

        // --- 1. é˜²èª¤è§¸é•·æŒ‰é‚è¼¯ ---
        const settingsTrigger = document.getElementById('settings-trigger-area');
        const settingsOverlay = document.getElementById('settings-overlay');
        const progressRing = document.getElementById('progress-ring');
        let pressTimer = null;

        function startPress(e) {
            e.preventDefault();
            progressRing.style.display = 'block';
            pressTimer = setTimeout(() => {
                openSettings();
                resetPress();
            }, 2000);
        }
        function endPress() { resetPress(); }
        function resetPress() {
            clearTimeout(pressTimer);
            progressRing.style.display = 'none';
        }
        function openSettings() {
            settingsOverlay.style.display = 'flex';
            updateLogDisplay();
        }

        settingsTrigger.addEventListener('mousedown', startPress);
        settingsTrigger.addEventListener('touchstart', startPress);
        settingsTrigger.addEventListener('mouseup', endPress);
        settingsTrigger.addEventListener('mouseleave', endPress);
        settingsTrigger.addEventListener('touchend', endPress);


        // --- 2. è¦–è¦ºæ¼¸é™¤ (æ§åˆ¶ç·šæ¢ç²—ç´° èˆ‡ SVGé€æ˜åº¦) ---
        const fadeSlider = document.getElementById('fade-slider');
        const fadeValDisplay = document.getElementById('fade-val');
        fadeSlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            const max = 50;
            // CSS ç·šæ¢ç²—ç´°
            const lineWidth = (val / 10).toFixed(1) + 'vmin';
            root.style.setProperty('--line-width', lineWidth);
            
            // SVG é€æ˜åº¦ (æœ€ä½ 0.1)
            const opacity = Math.max(0.1, val / max);
            svgFace.style.opacity = opacity;
            
            fadeValDisplay.textContent = Math.round((val / max) * 100) + '%';
        });

        
        // --- 3. æ•¸æ“šç´€éŒ„ ---
        function addLog() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-HK', { hour12: false });
            const modeName = currentMode === 'line' ? 'ç·šæ¢' : 'å¯¦å¿ƒEmoji';
            const themeName = document.querySelector('.option-btn.selected').innerText.trim();
            const intensity = fadeSlider.value;
            const logEntry = `[${timeStr}] æ¨¡å¼:${modeName} | ä¸»é¡Œ:${themeName} | å¼·åº¦:${intensity}`;
            sessionLogs.push(logEntry);
            if (sessionLogs.length > 50) sessionLogs.shift();
        }
        function updateLogDisplay() { logArea.value = sessionLogs.slice().reverse().join('\n'); }
        function copyLog() { logArea.select(); document.execCommand('copy'); alert('æ•¸æ“šå·²è¤‡è£½ï¼'); }
        function clearLog() { if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')) { sessionLogs = []; updateLogDisplay(); } }


        // --- 4. éŠæˆ²é‚è¼¯èˆ‡ä¸»é¡Œæ§åˆ¶ ---
        
        // å®šç¾©ç°¡å–®æ˜ç¢ºçš„ä¸»é¡Œè‰²å½©
        const themes = {
            'bw': { bg: '#000000', main: '#FFFFFF' }, // é»‘ç™½
            'br': { bg: '#000000', main: '#FF0000' }, // é»‘ç´…
            'wr': { bg: '#FFFFFF', main: '#FF0000' }, // ç™½ç´…
            'by': { bg: '#000000', main: '#FFD700' }, // é»‘é»ƒ
            'bb': { bg: '#000000', main: '#0066FF' }, // é»‘è—
            'bg': { bg: '#000000', main: '#00FF00' }  // é»‘ç¶ 
        };

        function setTheme(key) {
            currentTheme = key;
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.btn-group .option-btn').forEach(btn => {
                if(btn.id.startsWith('btn-b') || btn.id.startsWith('btn-w')) btn.classList.remove('selected');
            });
            document.getElementById('btn-' + key).classList.add('selected');
            
            // ç›´æ¥æ›´æ–° CSS è®Šæ•¸ï¼ŒSVG æœƒè‡ªå‹•åƒé€™äº›è®Šæ•¸
            const t = themes[key];
            root.style.setProperty('--bg-color', t.bg);
            root.style.setProperty('--main-color', t.main);
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('[id^="btn-mode-"]').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('btn-mode-' + mode).classList.add('selected');
            
            // åˆ‡æ›é¡¯ç¤º
            document.querySelectorAll('.css-face, .svg-face').forEach(el => el.classList.remove('current-face'));
            document.getElementById('face-' + mode).classList.add('current-face');
        }

        document.getElementById('size-slider').addEventListener('input', (e) => {
            gameScaler.style.width = e.target.value + 'vmin';
            gameScaler.style.height = e.target.value + 'vmin';
        });

        function triggerFeedback() {
            if (settingsOverlay.style.display === 'flex') return;
            if (isPlaying) return;

            isPlaying = true;
            addLog();

            gameScaler.classList.add('active');

            const sound = document.getElementById('sound-happy');
            sound.pause(); sound.currentTime = 0;
            sound.play().catch(e => console.log('Audio Blocked'));

            clearTimeout(animationTimer);
            animationTimer = setTimeout(() => {
                gameScaler.classList.remove('active');
                sound.pause(); sound.currentTime = 0;
                isPlaying = false;
            }, 5000);
        }

        document.getElementById('close-settings').addEventListener('click', () => {
            settingsOverlay.style.display = 'none';
        });

        document.body.addEventListener('click', triggerFeedback);
        document.body.addEventListener('touchstart', (e) => {
            if (!e.target.closest('.settings-box') && !e.target.closest('#settings-trigger-area')) {
                e.preventDefault(); 
                triggerFeedback();
            }
        }, { passive: false });

        // åˆå§‹åŒ–
        setTheme('bw');
        setMode('line');
        fadeSlider.dispatchEvent(new Event('input'));

    </script>
</body>
</html>    
